<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flying Emoji</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        
        body {
            font-family: 'Jua', sans-serif;
            overflow: hidden;
            touch-action: none; /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            background-color: #70c5ce; /* í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        .game-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .interactive {
            pointer-events: auto;
        }
        /* ì•„ì´í° ë…¸ì¹˜ ë“± ì•ˆì „ ì˜ì—­ ëŒ€ì‘ */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>
<body>

    <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
    <canvas id="gameCanvas"></canvas>

    <!-- ì ìˆ˜ í‘œì‹œ (ê²Œì„ ì¤‘) -->
    <div id="highScoreDisplay" class="absolute top-4 left-0 w-full text-center text-2xl text-yellow-300 font-bold drop-shadow-md hidden select-none pointer-events-none z-10">
        Best: 0
    </div>
    <div id="scoreDisplay" class="absolute top-12 left-0 w-full text-center text-5xl text-white font-bold drop-shadow-md hidden select-none pointer-events-none z-10">
        0
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="game-layer bg-black/40 backdrop-blur-sm z-20">
        <div class="bg-white/90 p-8 rounded-2xl shadow-2xl text-center interactive max-w-sm mx-4 border-4 border-blue-400">
            <h1 class="text-5xl font-bold text-blue-600 mb-2">Flying Emoji</h1>
            <p class="text-gray-600 mb-6 text-lg">ì´ëª¨ì§€ê°€ ë˜ì–´ ê±´ë¬¼ ì‚¬ì´ë¥¼ ë‚ ì•„ë³´ì„¸ìš”!</p>
            <div class="text-6xl animate-bounce mb-6">ğŸ¤ª</div>
            <p class="text-sm text-gray-500 mb-4">í„°ì¹˜ ë˜ëŠ” í´ë¦­ìœ¼ë¡œ ì í”„<br>ì í”„í•  ë•Œë§ˆë‹¤ í‘œì •ì´ ë°”ë€ë‹ˆë‹¤!</p>
            <button id="startBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-2xl shadow-lg transform transition active:scale-95">
                ê²Œì„ ì‹œì‘
            </button>
        </div>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div id="gameOverScreen" class="game-layer bg-black/60 backdrop-blur-md z-30 hidden">
        <!-- ê²Œì„ ì˜¤ë²„ ë°•ìŠ¤ (ê´‘ê³  ê³µê°„ í™•ë³´ë¥¼ ìœ„í•´ margin-bottom ì¶”ê°€) -->
        <div class="bg-white/90 p-8 rounded-2xl shadow-2xl text-center interactive max-w-sm mx-4 border-4 border-red-400 mb-32 relative">
            <h2 class="text-5xl font-bold text-red-500 mb-4">ê²Œì„ ì˜¤ë²„!</h2>
            <div class="flex justify-center space-x-8 mb-6">
                <div class="text-center">
                    <p class="text-gray-500 text-sm">ì ìˆ˜</p>
                    <p id="finalScore" class="text-4xl font-bold text-gray-800">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500 text-sm">ìµœê³  ì ìˆ˜</p>
                    <p id="bestScore" class="text-4xl font-bold text-yellow-500">0</p>
                </div>
            </div>
            <button id="restartBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full text-2xl shadow-lg transform transition active:scale-95">
                ë‹¤ì‹œ í•˜ê¸°
            </button>
        </div>

        <!-- í•˜ë‹¨ ê´‘ê³  ì˜ì—­ (êµ¬ê¸€ ì• ë“œì„¼ìŠ¤) -->
        <div class="absolute bottom-0 w-full flex justify-center items-end pb-safe interactive z-40 bg-white/20">
            <!-- 
                [ê°œë°œì ì°¸ê³ ] 
                ì‹¤ì œ êµ¬ê¸€ ì• ë“œì„¼ìŠ¤ ì½”ë“œë¥¼ ì•„ë˜ div ë‚´ë¶€ì— ë„£ìœ¼ì„¸ìš”.
                class="adsbygoogle" ë“±ì€ êµ¬ê¸€ì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            -->
            <div class="w-full max-w-[320px] h-[100px] bg-gray-100 border-2 border-dashed border-gray-400 flex flex-col items-center justify-center text-gray-500 text-xs mx-auto mb-2 shadow-lg">
                <span class="font-bold text-sm mb-1">ê´‘ê³  ì˜ì—­ (Google AdSense)</span>
                <span>ì´ê³³ì— ì‹¤ì œ ê´‘ê³ ê°€ í‘œì‹œë©ë‹ˆë‹¤.</span>
                
                <!-- ì˜ˆì‹œ ì½”ë“œ (ì£¼ì„ í•´ì œ í›„ ë³¸ì¸ ID ì…ë ¥) -->
                <!--
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
                     crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                     data-ad-slot="XXXXXXXXXX"
                     data-ad-format="auto"
                     data-ad-full-width-responsive="true"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                -->
            </div>
        </div>
    </div>

    <script>
        // --- ê²Œì„ ì„¤ì • ë° ë³€ìˆ˜ ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI ìš”ì†Œ
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const finalScoreEl = document.getElementById('finalScore');
        const bestScoreEl = document.getElementById('bestScore');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');

        // ê²Œì„ ìƒíƒœ
        let gameState = 'START'; // START, PLAYING, GAMEOVER
        let frames = 0;
        let score = 0;
        let highScore = localStorage.getItem('flyingEmojiHighScore') || 0;
        let gameSpeed = 3;

        // ì´ëª¨ì§€ ë°ì´í„°
        const faceEmojis = ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ¥²', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ¥´', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥º', 'ğŸ˜¡', 'ğŸ˜±'];
        const buildingEmojis = ['ğŸ¢', 'ğŸ¬', 'ğŸ­', 'ğŸ¥', 'ğŸ¦', 'ğŸ«', 'ğŸ¨'];

        // ë°˜ì‘í˜• ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // --- ê°ì²´ í´ë˜ìŠ¤ ---

        // í”Œë ˆì´ì–´ (ìƒˆ/ì´ëª¨ì§€)
        const bird = {
            x: 50,
            y: 150,
            radius: 20,
            velocity: 0,
            gravity: 0.25,
            jumpStrength: 7, // ì í”„ í˜ ì¡°ì •
            currentEmoji: 'ğŸ˜€',
            rotation: 0,

            draw: function() {
                ctx.save();
                ctx.translate(this.x, this.y);
                // ì†ë„ì— ë”°ë¼ íšŒì „ (ë–¨ì–´ì§ˆ ë•Œ ê³ ê°œ ìˆ™ì„)
                let targetRotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 4, (this.velocity * 0.1)));
                this.rotation = targetRotation;
                ctx.rotate(this.rotation);
                
                ctx.font = `${this.radius * 2.2}px Arial`; // ì´ëª¨ì§€ í¬ê¸° ì¡°ì •
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.currentEmoji, 0, 5); // ì•½ê°„ì˜ y ë³´ì •
                ctx.restore();
            },

            update: function() {
                this.velocity += this.gravity;
                this.y += this.velocity;

                // ë°”ë‹¥ ì¶©ëŒ
                if (this.y + this.radius >= canvas.height - 20) { // -20ì€ ë°”ë‹¥ ì—¬ë°±
                    this.y = canvas.height - 20 - this.radius;
                    gameOver();
                }

                // ì²œì¥ ì¶©ëŒ ë°©ì§€ (ì„ íƒ ì‚¬í•­)
                if (this.y - this.radius <= 0) {
                    this.y = this.radius;
                    this.velocity = 0;
                }
            },

            jump: function() {
                this.velocity = -this.jumpStrength;
                // ì í”„í•  ë•Œë§ˆë‹¤ ëœë¤ í‘œì •ìœ¼ë¡œ ë³€ê²½
                this.currentEmoji = faceEmojis[Math.floor(Math.random() * faceEmojis.length)];
            },
            
            reset: function() {
                this.x = canvas.width * 0.2; // í™”ë©´ì˜ 20% ì§€ì 
                this.y = canvas.height / 2;
                this.velocity = 0;
                this.currentEmoji = 'ğŸ˜€';
                this.radius = Math.min(window.innerWidth, window.innerHeight) * 0.05; // í™”ë©´ í¬ê¸°ì— ë¹„ë¡€
                if (this.radius < 15) this.radius = 15;
                if (this.radius > 30) this.radius = 30;
            }
        };

        // ì¥ì• ë¬¼ (ê±´ë¬¼ë“¤)
        const obstacles = {
            list: [],
            spawnTimer: 0,
            
            draw: function() {
                for (let i = 0; i < this.list.length; i++) {
                    let obs = this.list[i];
                    
                    // ê±´ë¬¼ ìŠ¤íƒ€ì¼ (íšŒìƒ‰ ê¸°ë‘¥ ìœ„ì— ì´ëª¨ì§€ íŒ¨í„´)
                    // ìœ„ìª½ ê±´ë¬¼
                    ctx.fillStyle = '#777'; 
                    // ctx.fillRect(obs.x, 0, obs.width, obs.top); // ë°°ê²½ ê¸°ë‘¥
                    
                    // ì•„ë˜ìª½ ê±´ë¬¼
                    // ctx.fillRect(obs.x, canvas.height - obs.bottom, obs.width, obs.bottom); // ë°°ê²½ ê¸°ë‘¥

                    // ì´ëª¨ì§€ë¡œ ê±´ë¬¼ ì±„ìš°ê¸° (ìœ„ìª½)
                    let emojiSize = obs.width;
                    ctx.font = `${emojiSize}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    
                    // ìœ„ìª½ íŒŒì´í”„ (ê±´ë¬¼) ê·¸ë¦¬ê¸°
                    for (let y = obs.top; y > -emojiSize; y -= emojiSize * 0.8) {
                         ctx.fillText(obs.buildingType, obs.x + obs.width/2, y);
                    }

                    // ì•„ë˜ìª½ íŒŒì´í”„ (ê±´ë¬¼) ê·¸ë¦¬ê¸°
                    ctx.textBaseline = 'top';
                    for (let y = canvas.height - obs.bottom; y < canvas.height + emojiSize; y += emojiSize * 0.8) {
                        ctx.fillText(obs.buildingType, obs.x + obs.width/2, y);
                    }
                }
            },

            update: function() {
                // ì¥ì• ë¬¼ ìƒì„± ì£¼ê¸° (í™”ë©´ ë„ˆë¹„ì— ë”°ë¼ ì¡°ì ˆ)
                const spawnRate = Math.floor(100 + (canvas.width / 10)); 
                
                if (frames % spawnRate === 0) {
                    // ê°­ í¬ê¸° ì„¤ì • (í™”ë©´ ë†’ì´ ë¹„ë¡€)
                    const gap = Math.max(160, canvas.height * 0.25);
                    const minHeight = canvas.height * 0.1;
                    const maxTop = canvas.height - minHeight - gap;
                    const topHeight = Math.floor(Math.random() * (maxTop - minHeight + 1) + minHeight);
                    const bottomHeight = canvas.height - gap - topHeight;

                    this.list.push({
                        x: canvas.width,
                        width: bird.radius * 3.5, // í”Œë ˆì´ì–´ í¬ê¸°ì— ë¹„ë¡€í•œ ì¥ì• ë¬¼ ë„ˆë¹„
                        top: topHeight,
                        bottom: bottomHeight,
                        passed: false,
                        buildingType: buildingEmojis[Math.floor(Math.random() * buildingEmojis.length)]
                    });
                }

                for (let i = 0; i < this.list.length; i++) {
                    let obs = this.list[i];
                    obs.x -= gameSpeed;

                    // ì¶©ëŒ ê°ì§€ (ê°„ë‹¨í•œ AABB ì¶©ëŒ)
                    // ì´ëª¨ì§€ëŠ” ì›í˜•ì´ì§€ë§Œ, íˆíŠ¸ë°•ìŠ¤ëŠ” ì‚¬ê°í˜•ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ë‚œì´ë„ ì¡°ì ˆ
                    const hitBoxPadding = bird.radius * 0.6; // ì•½ê°„ ì—¬ìœ ë¥¼ ë‘ 

                    // ìƒˆì˜ íˆíŠ¸ë°•ìŠ¤
                    const birdLeft = bird.x - bird.radius + hitBoxPadding;
                    const birdRight = bird.x + bird.radius - hitBoxPadding;
                    const birdTop = bird.y - bird.radius + hitBoxPadding;
                    const birdBottom = bird.y + bird.radius - hitBoxPadding;

                    // ìœ„ìª½ ê±´ë¬¼ ì¶©ëŒ
                    if (birdRight > obs.x && birdLeft < obs.x + obs.width && birdTop < obs.top) {
                        gameOver();
                    }
                    // ì•„ë˜ìª½ ê±´ë¬¼ ì¶©ëŒ
                    if (birdRight > obs.x && birdLeft < obs.x + obs.width && birdBottom > canvas.height - obs.bottom) {
                        gameOver();
                    }

                    // ì ìˆ˜ íšë“
                    if (obs.x + obs.width < bird.x && !obs.passed) {
                        score++;
                        scoreDisplay.innerText = score;
                        obs.passed = true;
                        // ë‚œì´ë„ ìƒìŠ¹ (ì†ë„ ì•½ê°„ ì¦ê°€, ìµœëŒ€ì¹˜ ì œí•œ)
                        if(score % 5 === 0 && gameSpeed < 6) gameSpeed += 0.2;
                    }

                    // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ì¥ì• ë¬¼ ì œê±°
                    if (obs.x + obs.width < 0) {
                        this.list.shift();
                        i--;
                    }
                }
            },
            
            reset: function() {
                this.list = [];
                gameSpeed = 3 + (canvas.width > 768 ? 1 : 0); // PCì—ì„œëŠ” ì¡°ê¸ˆ ë” ë¹ ë¥´ê²Œ ì‹œì‘
            }
        };

        // ë°°ê²½ (êµ¬ë¦„)
        const background = {
            clouds: [],
            
            draw: function() {
                // ë°”ë‹¥ ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#ded895'; // ë•… ìƒ‰ê¹”
                ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
                
                // êµ¬ë¦„ ê·¸ë¦¬ê¸°
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                this.clouds.forEach(cloud => {
                    ctx.beginPath();
                    ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 0.7, cloud.y - cloud.size * 0.5, cloud.size * 0.8, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 1.4, cloud.y, cloud.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            },
            
            update: function() {
                // êµ¬ë¦„ ìƒì„±
                if (Math.random() < 0.01) {
                    this.clouds.push({
                        x: canvas.width + 50,
                        y: Math.random() * (canvas.height * 0.6),
                        size: Math.random() * 30 + 20,
                        speed: Math.random() * 0.5 + 0.2
                    });
                }
                
                // êµ¬ë¦„ ì´ë™
                for (let i = 0; i < this.clouds.length; i++) {
                    let cloud = this.clouds[i];
                    cloud.x -= cloud.speed;
                    if (cloud.x < -100) {
                        this.clouds.shift();
                        i--;
                    }
                }
            }
        };

        // --- ê²Œì„ ë¡œì§ ---

        function initGame() {
            bird.reset();
            obstacles.reset();
            score = 0;
            frames = 0;
            
            scoreDisplay.innerText = score;
            highScoreDisplay.innerText = `Best: ${highScore}`;

            scoreDisplay.classList.remove('hidden');
            highScoreDisplay.classList.remove('hidden');
        }

        function startGame() {
            gameState = 'PLAYING';
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            initGame();
            loop();
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            scoreDisplay.classList.add('hidden');
            highScoreDisplay.classList.add('hidden');
            
            // ìµœê³  ì ìˆ˜ ê°±ì‹ 
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('flyingEmojiHighScore', highScore);
            }
            
            finalScoreEl.innerText = score;
            bestScoreEl.innerText = highScore;
            
            gameOverScreen.classList.remove('hidden');
            gameOverScreen.style.display = 'flex'; // flex ë ˆì´ì•„ì›ƒ ê°•ì œ
        }

        function loop() {
            // í™”ë©´ ì§€ìš°ê¸°
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ì—…ë°ì´íŠ¸ & ê·¸ë¦¬ê¸°
            background.update();
            background.draw();

            if (gameState === 'PLAYING') {
                obstacles.update();
                obstacles.draw();
                
                bird.update();
                bird.draw();
                
                frames++;
                requestAnimationFrame(loop);
            } else if (gameState === 'GAMEOVER') {
                // ê²Œì„ ì˜¤ë²„ ì‹œì—ë„ ì •ì§€ëœ í™”ë©´ ê·¸ë ¤ì£¼ê¸°
                obstacles.draw();
                bird.draw();
            }
        }

        // --- ì…ë ¥ ì²˜ë¦¬ ---

        function handleInput(e) {
            if (e.type !== 'keydown') {
                 e.preventDefault(); // í„°ì¹˜ ì‹œ ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ ë“±
            }

            if (gameState === 'PLAYING') {
                bird.jump();
            } else if (gameState === 'START' || gameState === 'GAMEOVER') {
                // UI ë²„íŠ¼ì´ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” íŒ¨ìŠ¤í•˜ê±°ë‚˜, 
                // í‚¤ë³´ë“œ ìŠ¤í˜ì´ìŠ¤ë°”ì˜ ê²½ìš° ë²„íŠ¼ í´ë¦­ íš¨ê³¼ë¥¼ ì¤„ ìˆ˜ ìˆìŒ
                if (e.code === 'Space') {
                    if (gameState === 'START') startGame();
                    if (gameState === 'GAMEOVER') startGame();
                }
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') handleInput(e);
        });
        
        // ìº”ë²„ìŠ¤ í„°ì¹˜/í´ë¦­
        canvas.addEventListener('touchstart', handleInput, {passive: false});
        canvas.addEventListener('mousedown', handleInput);

        // ë²„íŠ¼ ì´ë²¤íŠ¸
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);

        // ì´ˆê¸° í™”ë©´ ë Œë”ë§ (ë°°ê²½ë§Œ)
        background.update(); // êµ¬ë¦„ ëª‡ ê°œ ìƒì„±
        background.draw();

    </script>
</body>
</html>
