<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flying Emoji</title>
    
    <!-- [ì¤‘ìš”] êµ¬ê¸€ ì• ë“œì„¼ìŠ¤ ìë™ ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ -->
    <!-- ì•„ë˜ ca-pub- ë’¤ì˜ ìˆ«ìë¥¼ ë³¸ì¸ì˜ ì‹¤ì œ ê²Œì‹œì IDë¡œ ë³€ê²½í•˜ì„¸ìš” -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4900244474968005"
     crossorigin="anonymous"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        
        body {
            font-family: 'Jua', sans-serif;
            overflow: hidden;
            touch-action: none; /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            background-color: #70c5ce; /* í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            -webkit-user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            user-select: none;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        .game-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 50; /* ë ˆì´ì–´ ìˆœì„œ í™•ì‹¤íˆ ì•ìœ¼ë¡œ */
        }
        .interactive {
            pointer-events: auto;
        }
        /* ë²„íŠ¼ ëˆŒë¦¼ íš¨ê³¼ */
        .btn-press:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>

    <!-- ê²Œì„ ìº”ë²„ìŠ¤ -->
    <canvas id="gameCanvas"></canvas>

    <!-- ì ìˆ˜ í‘œì‹œ (ê²Œì„ ì¤‘) -->
    <div id="highScoreDisplay" class="absolute top-4 left-0 w-full text-center text-2xl text-yellow-300 font-bold drop-shadow-md hidden select-none pointer-events-none z-10">
        Best: 0
    </div>
    <div id="scoreDisplay" class="absolute top-12 left-0 w-full text-center text-5xl text-white font-bold drop-shadow-md hidden select-none pointer-events-none z-10">
        0
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="game-layer bg-black/40 backdrop-blur-sm">
        <div class="bg-white/90 p-8 rounded-2xl shadow-2xl text-center interactive max-w-sm mx-4 border-4 border-blue-400">
            <h1 class="text-5xl font-bold text-blue-600 mb-2">Flying Emoji</h1>
            <p class="text-gray-600 mb-6 text-lg">ì´ëª¨ì§€ê°€ ë˜ì–´ ê±´ë¬¼ ì‚¬ì´ë¥¼ ë‚ ì•„ë³´ì„¸ìš”!</p>
            <div class="text-6xl animate-bounce mb-6">ğŸ¤ª</div>
            <p class="text-sm text-gray-500 mb-4">í„°ì¹˜ ë˜ëŠ” í´ë¦­ìœ¼ë¡œ ì í”„<br>5ì ë§ˆë‹¤ ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤!</p>
            <button id="startBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-10 rounded-full text-2xl shadow-lg btn-press">
                ê²Œì„ ì‹œì‘
            </button>
        </div>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div id="gameOverScreen" class="game-layer bg-black/60 backdrop-blur-md hidden" style="display: none;">
        <div class="bg-white/90 p-8 rounded-2xl shadow-2xl text-center interactive max-w-sm mx-4 border-4 border-red-400 relative">
            <h2 class="text-5xl font-bold text-red-500 mb-4">ê²Œì„ ì˜¤ë²„!</h2>
            <div class="flex justify-center space-x-8 mb-6">
                <div class="text-center">
                    <p class="text-gray-500 text-sm">ì ìˆ˜</p>
                    <p id="finalScore" class="text-4xl font-bold text-gray-800">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500 text-sm">ìµœê³  ì ìˆ˜</p>
                    <p id="bestScore" class="text-4xl font-bold text-yellow-500">0</p>
                </div>
            </div>
            <!-- ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜í•˜ê¸° ì‰½ë„ë¡ ë²„íŠ¼ í¬ê¸° í™•ëŒ€ -->
            <button id="restartBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-12 rounded-full text-3xl shadow-lg btn-press w-full">
                ë‹¤ì‹œ í•˜ê¸°
            </button>
        </div>
    </div>

    <script>
        // --- ê²Œì„ ì„¤ì • ë° ë³€ìˆ˜ ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // UI ìš”ì†Œ
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const finalScoreEl = document.getElementById('finalScore');
        const bestScoreEl = document.getElementById('bestScore');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');

        // ì˜¤ë””ì˜¤ ì„¤ì • (ë™ì „ íš¨ê³¼ìŒ)
        // ë¬´ë£Œ íš¨ê³¼ìŒ URL ì‚¬ìš©
        const coinSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
        coinSound.volume = 0.5; // ë³¼ë¥¨ ì¡°ì ˆ

        // ê²Œì„ ìƒíƒœ
        let gameState = 'START'; // START, PLAYING, GAMEOVER
        let frames = 0;
        let score = 0;
        let highScore = localStorage.getItem('flyingEmojiHighScore') || 0;
        
        // ì†ë„ ê´€ë ¨ ë³€ìˆ˜
        const baseSpeed = 3; // ê¸°ë³¸ ì†ë„ (100%)
        const maxSpeed = baseSpeed * 1.5; // ìµœëŒ€ ì†ë„ (150% = 4.5)
        const speedIncrement = baseSpeed * 0.1; // ì¦ê°€ëŸ‰ (10% = 0.3)
        let gameSpeed = baseSpeed;
        
        // ì…ë ¥ ë”œë ˆì´
        let inputLocked = false;

        // ì´ëª¨ì§€ ë°ì´í„°
        const faceEmojis = ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ¥²', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ¥´', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥º', 'ğŸ˜¡', 'ğŸ˜±'];
        const buildingEmojis = ['ğŸ¢', 'ğŸ¬', 'ğŸ­', 'ğŸ¥', 'ğŸ¦', 'ğŸ«', 'ğŸ¨'];

        // ë°˜ì‘í˜• ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // --- ê°ì²´ í´ë˜ìŠ¤ ---

        // í”Œë ˆì´ì–´ (ìƒˆ/ì´ëª¨ì§€)
        const bird = {
            x: 50,
            y: 150,
            radius: 20,
            velocity: 0,
            gravity: 0.25,
            jumpStrength: 7, 
            currentEmoji: 'ğŸ˜€',
            rotation: 0,

            draw: function() {
                ctx.save();
                ctx.translate(this.x, this.y);
                // ì†ë„ì— ë”°ë¼ íšŒì „ (ë–¨ì–´ì§ˆ ë•Œ ê³ ê°œ ìˆ™ì„)
                let targetRotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 4, (this.velocity * 0.1)));
                this.rotation = targetRotation;
                ctx.rotate(this.rotation);
                
                ctx.font = `${this.radius * 2.2}px Arial`; 
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(this.currentEmoji, 0, 5); 
                ctx.restore();
            },

            update: function() {
                this.velocity += this.gravity;
                this.y += this.velocity;

                // ë°”ë‹¥ ì¶©ëŒ
                if (this.y + this.radius >= canvas.height - 20) { 
                    this.y = canvas.height - 20 - this.radius;
                    gameOver();
                }

                // ì²œì¥ ì¶©ëŒ ë°©ì§€
                if (this.y - this.radius <= 0) {
                    this.y = this.radius;
                    this.velocity = 0;
                }
            },

            jump: function() {
                this.velocity = -this.jumpStrength;
                this.currentEmoji = faceEmojis[Math.floor(Math.random() * faceEmojis.length)];
            },
            
            reset: function() {
                this.x = canvas.width * 0.2; 
                this.y = canvas.height / 2;
                this.velocity = 0;
                this.currentEmoji = 'ğŸ˜€';
                this.radius = Math.min(window.innerWidth, window.innerHeight) * 0.05; 
                if (this.radius < 15) this.radius = 15;
                if (this.radius > 30) this.radius = 30;
            }
        };

        // ì¥ì• ë¬¼ (ê±´ë¬¼ë“¤)
        const obstacles = {
            list: [],
            distanceSinceLastSpawn: 0, // ë§ˆì§€ë§‰ ìƒì„± ì´í›„ ì´ë™í•œ ê±°ë¦¬
            nextSpawnDistance: 0,      // ë‹¤ìŒ ìƒì„±ê¹Œì§€ í•„ìš”í•œ ê±°ë¦¬
            
            draw: function() {
                for (let i = 0; i < this.list.length; i++) {
                    let obs = this.list[i];
                    
                    ctx.fillStyle = '#777'; 

                    let emojiSize = obs.width;
                    ctx.font = `${emojiSize}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';
                    
                    // ìœ„ìª½ íŒŒì´í”„
                    for (let y = obs.top; y > -emojiSize; y -= emojiSize * 0.8) {
                         ctx.fillText(obs.buildingType, obs.x + obs.width/2, y);
                    }

                    // ì•„ë˜ìª½ íŒŒì´í”„
                    ctx.textBaseline = 'top';
                    for (let y = canvas.height - obs.bottom; y < canvas.height + emojiSize; y += emojiSize * 0.8) {
                        ctx.fillText(obs.buildingType, obs.x + obs.width/2, y);
                    }
                }
            },

            update: function() {
                // [ìˆ˜ì •ë¨] ê±°ë¦¬ ê¸°ë°˜ ëœë¤ ìƒì„± ë¡œì§
                
                // 1. ì´ë™ ê±°ë¦¬ ëˆ„ì 
                this.distanceSinceLastSpawn += gameSpeed;

                // 2. ìƒì„± ì‹œì  ë„ë‹¬ ì²´í¬
                if (this.distanceSinceLastSpawn >= this.nextSpawnDistance) {
                    
                    // ê°­ í¬ê¸° ì„¤ì • (ê¸°ì¡´ ë¡œì§ ìœ ì§€: ëœë¤ ë†’ì´)
                    const maxGap = Math.max(160, canvas.height * 0.25) * 1.2;
                    const minGap = (bird.radius * 2.2) * 3.0;
                    const actualMaxGap = Math.max(maxGap, minGap + 10);
                    const gap = Math.random() * (actualMaxGap - minGap) + minGap;

                    const minHeight = canvas.height * 0.1;
                    const maxTop = canvas.height - minHeight - gap;
                    
                    let topHeight;
                    if (maxTop < minHeight) {
                        topHeight = minHeight; 
                    } else {
                        topHeight = Math.floor(Math.random() * (maxTop - minHeight + 1) + minHeight);
                    }
                    
                    const bottomHeight = canvas.height - gap - topHeight;

                    // ì¥ì• ë¬¼ ì¶”ê°€
                    this.list.push({
                        x: canvas.width,
                        width: bird.radius * 3.5, 
                        top: topHeight,
                        bottom: bottomHeight,
                        passed: false,
                        buildingType: buildingEmojis[Math.floor(Math.random() * buildingEmojis.length)]
                    });

                    // 3. ë‹¤ìŒ ìƒì„± ê±°ë¦¬(Interval) ëœë¤ ì„¤ì •
                    // ê¸°ì¤€ ê±°ë¦¬: bird.radius * 22
                    const baseDistance = bird.radius * 22;
                    
                    // ìµœì†Œ: ê¸°ì¤€ì˜ 50% (ì ˆë°˜)
                    const minDistance = baseDistance * 0.5;
                    // ìµœëŒ€: ê¸°ì¤€ì˜ 120% (20% ë” ë„“ê²Œ)
                    const maxDistance = baseDistance * 1.2;
                    
                    // ëœë¤ ê±°ë¦¬ ì„¤ì •
                    this.nextSpawnDistance = Math.random() * (maxDistance - minDistance) + minDistance;
                    
                    // ëˆ„ì  ê±°ë¦¬ ì´ˆê¸°í™”
                    this.distanceSinceLastSpawn = 0;
                }

                for (let i = 0; i < this.list.length; i++) {
                    let obs = this.list[i];
                    obs.x -= gameSpeed;

                    const hitBoxPadding = bird.radius * 0.6; 

                    const birdLeft = bird.x - bird.radius + hitBoxPadding;
                    const birdRight = bird.x + bird.radius - hitBoxPadding;
                    const birdTop = bird.y - bird.radius + hitBoxPadding;
                    const birdBottom = bird.y + bird.radius - hitBoxPadding;

                    // ì¶©ëŒ ì²´í¬
                    if (birdRight > obs.x && birdLeft < obs.x + obs.width && birdTop < obs.top) {
                        gameOver();
                    }
                    if (birdRight > obs.x && birdLeft < obs.x + obs.width && birdBottom > canvas.height - obs.bottom) {
                        gameOver();
                    }

                    // ì ìˆ˜ ë° ì†ë„ ì¦ê°€ ë¡œì§
                    if (obs.x + obs.width < bird.x && !obs.passed) {
                        score++;
                        scoreDisplay.innerText = score;
                        obs.passed = true;
                        
                        // 5ì ë§ˆë‹¤ ì´ë²¤íŠ¸ ë°œìƒ
                        if (score % 5 === 0) {
                            // 1. ë™ì „ ì†Œë¦¬ ì¬ìƒ
                            // ì—°ì† ì¬ìƒì„ ìœ„í•´ currentTime ì´ˆê¸°í™”
                            coinSound.currentTime = 0;
                            coinSound.play().catch(e => console.log('Audio play failed:', e));

                            // 2. ì†ë„ ì¦ê°€ (10%ì”©)
                            if (gameSpeed < maxSpeed) {
                                gameSpeed += speedIncrement;
                                // ìµœëŒ€ ì†ë„ ì´ˆê³¼ ë°©ì§€
                                if (gameSpeed > maxSpeed) {
                                    gameSpeed = maxSpeed;
                                }
                            }
                        }
                    }

                    if (obs.x + obs.width < 0) {
                        this.list.shift();
                        i--;
                    }
                }
            },
            
            reset: function() {
                this.list = [];
                // ê²Œì„ ì¬ì‹œì‘ ì‹œ ì†ë„ ì´ˆê¸°í™”
                gameSpeed = baseSpeed;
                
                // ê±°ë¦¬ ê´€ë ¨ ë³€ìˆ˜ ì´ˆê¸°í™”
                this.distanceSinceLastSpawn = 0;
                // ì²« ì¥ì• ë¬¼ì€ ì•½ê°„ì˜ ì—¬ìœ ë¥¼ ë‘ê³  ìƒì„± (ê¸°ì¤€ ê±°ë¦¬ë§Œí¼)
                this.nextSpawnDistance = bird.radius * 22;
            }
        };

        // ë°°ê²½
        const background = {
            clouds: [],
            draw: function() {
                ctx.fillStyle = '#ded895'; 
                ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                this.clouds.forEach(cloud => {
                    ctx.beginPath();
                    ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 0.7, cloud.y - cloud.size * 0.5, cloud.size * 0.8, 0, Math.PI * 2);
                    ctx.arc(cloud.x + cloud.size * 1.4, cloud.y, cloud.size, 0, Math.PI * 2);
                    ctx.fill();
                });
            },
            update: function() {
                if (Math.random() < 0.01) {
                    this.clouds.push({
                        x: canvas.width + 50,
                        y: Math.random() * (canvas.height * 0.6),
                        size: Math.random() * 30 + 20,
                        speed: Math.random() * 0.5 + 0.2
                    });
                }
                for (let i = 0; i < this.clouds.length; i++) {
                    let cloud = this.clouds[i];
                    cloud.x -= cloud.speed;
                    if (cloud.x < -100) {
                        this.clouds.shift();
                        i--;
                    }
                }
            }
        };

        // --- ê²Œì„ ë¡œì§ ---

        function initGame() {
            bird.reset();
            obstacles.reset();
            score = 0;
            frames = 0;
            
            scoreDisplay.innerText = score;
            highScoreDisplay.innerText = `Best: ${highScore}`;

            scoreDisplay.classList.remove('hidden');
            highScoreDisplay.classList.remove('hidden');
        }

        function startGame() {
            if (gameState === 'PLAYING') return;

            gameState = 'PLAYING';
            
            // ëª¨ë°”ì¼ ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™”ë¥¼ ìœ„í•´ ì‚¬ìš©ì ì¸í„°ë™ì…˜ ì‹œì ì— load() í˜¸ì¶œ ê°€ëŠ¥
            // (í˜„ëŒ€ ë¸Œë¼ìš°ì €ëŠ” ì‚¬ìš©ì ì œìŠ¤ì²˜(í´ë¦­) ë‚´ì—ì„œ play() í•˜ë©´ í—ˆìš©ë¨)
            
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            initGame();
            
            inputLocked = true;
            setTimeout(() => {
                inputLocked = false;
            }, 60);

            if (!animationId) {
                loop();
            }
        }

        let animationId;

        function gameOver() {
            if (gameState === 'GAMEOVER') return;
            gameState = 'GAMEOVER';
            
            scoreDisplay.classList.add('hidden');
            highScoreDisplay.classList.add('hidden');
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('flyingEmojiHighScore', highScore);
            }
            
            finalScoreEl.innerText = score;
            bestScoreEl.innerText = highScore;
            
            gameOverScreen.style.display = 'flex';
        }

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            background.update();
            background.draw();

            if (gameState === 'PLAYING') {
                obstacles.update();
                obstacles.draw();
                bird.update();
                bird.draw();
                frames++;
            } else if (gameState === 'GAMEOVER') {
                obstacles.draw();
                bird.draw();
            } else if (gameState === 'START') {
                 
            }

            animationId = requestAnimationFrame(loop);
        }

        // --- ì…ë ¥ ë° ì´ë²¤íŠ¸ ì²˜ë¦¬ ---

        function handleGameInput(e) {
            if (inputLocked || gameState !== 'PLAYING') return;
            
            if (e.target === canvas && e.cancelable) {
                e.preventDefault();
            }
            
            bird.jump();
        }

        function handleButtonClick(e) {
            e.stopPropagation();
            if (e.cancelable) e.preventDefault();
            
            startGame();
        }

        canvas.addEventListener('touchstart', handleGameInput, {passive: false});
        canvas.addEventListener('mousedown', handleGameInput);
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (gameState === 'PLAYING') handleGameInput(e);
                else handleButtonClick(e); 
            }
        });

        startBtn.addEventListener('touchend', handleButtonClick, {passive: false});
        startBtn.addEventListener('click', handleButtonClick);
        
        restartBtn.addEventListener('touchend', handleButtonClick, {passive: false});
        restartBtn.addEventListener('click', handleButtonClick);

        loop();

    </script>
</body>
</html>
